<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suspend Diagnosis Report</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f7fa;
            padding: 2rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #1a202c;
            border-bottom: 3px solid #3182ce;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
            font-size: 2rem;
        }
        
        h2 {
            color: #2d3748;
            margin-top: 2rem;
            margin-bottom: 1rem;
            padding: 0.75rem 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 6px;
            font-size: 1.5rem;
        }
        
        h3 {
            color: #4a5568;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            font-size: 1.25rem;
        }
        
        hr {
            border: none;
            border-top: 2px solid #e2e8f0;
            margin: 2rem 0;
        }
        
        p {
            margin-bottom: 1rem;
        }
        
        strong {
            color: #2d3748;
            font-weight: 600;
        }
        
        ul, ol {
            margin-left: 2rem;
            margin-bottom: 1rem;
        }
        
        li {
            margin-bottom: 0.5rem;
        }
        
        code {
            background: #f7fafc;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
            color: #e53e3e;
        }
        
        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            margin-bottom: 1rem;
        }
        
        pre code {
            background: transparent;
            color: inherit;
            padding: 0;
        }
        
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 1.5rem;
            background: white;
        }
        
        th, td {
            border: 1px solid #e2e8f0;
            padding: 0.75rem;
            text-align: left;
        }
        
        th {
            background: #edf2f7;
            font-weight: 600;
            color: #2d3748;
        }
        
        tr:hover {
            background: #f7fafc;
        }
        
        .status-success {
            color: #38a169;
            font-weight: bold;
        }
        
        .status-failure {
            color: #e53e3e;
            font-weight: bold;
        }
        
        .section-card {
            background: #f7fafc;
            border-left: 4px solid #3182ce;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 4px;
        }
        
        .finding-item {
            background: #fff5f5;
            border-left: 3px solid #fc8181;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 3px;
        }
        
        .finding-item.normal {
            background: #f0fff4;
            border-left-color: #68d391;
        }
        
        .ai-section {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 2rem 0;
        }
        
        .checklist {
            background: #fffaf0;
            border: 2px solid #ed8936;
            padding: 1.5rem;
            border-radius: 8px;
        }
        
        .checklist li {
            padding: 0.5rem 0;
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            .container {
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
<h1>Suspend Diagnosis Report</h1>
<p><strong>Collection Directory</strong>: <code>C:\Users\xingya\OneDrive - Qualcomm\Desktop\AI_tools\suspend_mvp\cases\suspend\blocked_bywakelock</code><br />
<strong>Time</strong>: 2025-11-23T18:01:54.929086</p>
<hr />
<h2>üî¥ CONCLUSION: Suspend Failure Detected</h2>
<p><strong>Root Cause</strong>: Root cause: Active wakelocks preventing suspend: PowerManagerService.Display, PowerManager.SuspendLockout, a600000.hsusb</p>
<hr />
<h2>Step 2Ô∏è‚É£: Wakelock Analysis</h2>
<p><strong>Purpose</strong>: Check for active wakelocks preventing suspend<br />
<strong>File</strong>: <code>dumpsys suspend_control_internal</code> ‚Üí <code>dumpsys_suspend.txt</code></p>
<p>‚ùå <strong>Result</strong>: Active wakelocks found (ROOT CAUSE)
<strong>Active Wakelocks</strong>:
- <code>PowerManagerService.Display</code>
- <code>PowerManager.SuspendLockout</code>
- <code>a600000.hsusb</code></p>
<p><strong>Analysis stops here</strong> - Root cause identified</p>
<h3>ÂéüÂßã Wakelock Dump (ÂÖ≥ÈîÆÁâáÊÆµ)</h3>
<pre><code class="language-text"> |                                                                                           WAKELOCK STATS                                                                                        | 
 | NAME                           | PID    | TYPE   | STATUS   | ACTIVE COUNT | TOTAL TIME   | MAX TIME     | EVENT COUNT  | WAKEUP COUNT | EXPIRE COUNT | PREVENT SUSPEND TIME | LAST CHANGE      | 
 | PowerManagerService.WakeLocks  |   1922 | Native | Inactive |            0 |      13204ms |       6497ms |          --- |          --- |          --- |                  --- |        1091401ms | 
 | PowerManagerService.Broadcasts |   1922 | Native | Inactive |            0 |        168ms |        141ms |          --- |          --- |          --- |                  --- |         810554ms | 
 | PowerManagerService.Display    |   1922 | Native | Active   |            1 |     941874ms |     653247ms |          --- |          --- |          --- |                  --- |        1099043ms | 
 | PowerManager.SuspendLockout    |   1922 | Native | Active   |            1 |     941839ms |     653211ms |          --- |          --- |          --- |                  --- |        1099043ms | 
 | radio-interface                |   1263 | Native | Inactive |            0 |        227ms |        217ms |          --- |          --- |          --- |                  --- |         140169ms | 
 | ApmOutput                      |   2453 | Native | Inactive |            0 |       1023ms |         44ms |          --- |          --- |          --- |                  --- |         137884ms | 
 | PowerManagerService.Booting    |   1922 | Native | Inactive |            0 |      52860ms |      52860ms |          --- |          --- |          --- |                  --- |         137126ms | 
 | qms_event_Handler_wakeLock_    |   1413 | Native | Inactive |            0 |        607ms |        445ms |          --- |          --- |          --- |                  --- |         124920ms | 
 | ApmAudio                       |   2453 | Native | Inactive |            0 |        498ms |         88ms |          --- |          --- |          --- |                  --- |         102870ms | 
 | ApmOutput                      |   1209 | Native | Inactive |            0 |         10ms |          4ms |          --- |          --- |          --- |                  --- |          89723ms | 
 | ApmAudio                       |   1209 | Native | Inactive |            0 |        222ms |         71ms |          --- |          --- |          --- |                  --- |          89717ms | 
 | qcril_pre_client_init          |   1263 | Native | Inactive |            0 |       1388ms |       1388ms |          --- |          --- |          --- |                  --- |          78474ms | 
 | event3                         |    --- | Kernel | Inactive |            4 |          3ms |          1ms |            4 |            0 |            0 |                  0ms |         810533ms | 
 | [timerfd]                      |    --- | Kernel | Inactive |            0 |          0ms |          0ms |            0 |            0 |            0 |                  0ms |              0ms | 
 | c42d000.qcom,spmi:pmw6100@0:pon_hlos@1300:pwrkey |    --- | Kernel | Inactive |            0 |          0ms |          0ms |            0 |            0 |            0 |                  0ms |              0ms | 
 | usb                            |    --- | Kernel | Inactive |            2 |        144ms |         98ms |            2 |            0 |            0 |                  0ms |          78847ms | 
 | fastrpc-non_secure             |    --- | Kernel | Inactive |            0 |          0ms |          0ms |            0 |            0 |            0 |                  0ms |              0ms | 
 | rmt_storage_541074766912       |    --- | Kernel | Inactive |            2 |         78ms |         75ms |            2 |            0 |            0 |                  0ms |         167621ms | 
... (truncated)
</code></pre>
<hr />
<h2>üìã ÊÄªÁªì</h2>
<p><strong>ÁªìËÆ∫</strong>: Root cause: Active wakelocks preventing suspend: PowerManagerService.Display, PowerManager.SuspendLockout, a600000.hsusb</p>
<hr />
<h2>ü§ñ AI Comprehensive Analysis</h2>
<h2>Suspend Status</h2>
<ul>
<li><strong>Suspend attempts:</strong> 0  </li>
<li><strong>Successful suspends:</strong> 0  </li>
<li><strong>Failed suspends:</strong> 0  </li>
</ul>
<p>The <code>/d/suspend_stats</code> file is empty, and the <code>dumpsys suspend_control_internal</code> dump shows <strong>no suspend attempts</strong> have been made. This means the system has never entered a suspend cycle since the logs were captured.</p>
<h2>Wakelock Analysis</h2>
<table>
<thead>
<tr>
<th>Name</th>
<th>PID</th>
<th>Type</th>
<th>Status</th>
<th>Active Count</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>PowerManagerService.Display</strong></td>
<td>1922</td>
<td>Native</td>
<td><strong>Active</strong></td>
<td>1</td>
</tr>
<tr>
<td><strong>PowerManager.SuspendLockout</strong></td>
<td>1922</td>
<td>Native</td>
<td><strong>Active</strong></td>
<td>1</td>
</tr>
<tr>
<td><strong>a600000.hsusb</strong></td>
<td>‚Äì</td>
<td>Kernel</td>
<td><strong>Active</strong></td>
<td>1</td>
</tr>
</tbody>
</table>
<ul>
<li>The <strong>Display</strong> wakelock is held, indicating the screen (or a component that pretends the screen is on) is preventing suspend.  </li>
<li>The <strong>SuspendLockout</strong> wakelock is also active; this is a system‚Äëlevel lock that deliberately blocks suspend (often set while a critical operation is in progress).  </li>
<li>A kernel‚Äëlevel USB wakelock (<code>a600000.hsusb</code>) is active, meaning the USB controller is preventing the device from sleeping.</li>
</ul>
<p>No other wakelocks are currently active, and the <code>last_failed_suspend</code> counter is <strong>0</strong>, confirming that suspend is not failing because of an error ‚Äì it is simply being blocked by the above wake locks.</p>
<h2>Root Cause (if applicable)</h2>
<p><em>Not applicable.</em> Suspend has not failed; it has never been attempted because active wake locks are blocking it.</p>
<h2>Recommendations</h2>
<ol>
<li><strong>Identify why the Display wakelock is held</strong></li>
<li>Verify that the screen is actually on. If the device is in a ‚Äúscreen‚Äëon‚Äù state (e.g., a foreground app has requested <code>FLAG_KEEP_SCREEN_ON</code>), the wake lock will stay active.</li>
<li>Use <code>adb shell dumpsys activity top</code> or <code>adb shell dumpsys window windows</code> to see which activity is keeping the screen awake.</li>
<li>
<p>If an app is misbehaving, force‚Äëstop it (<code>adb shell am force-stop &lt;package&gt;</code>) or uninstall the offending app.</p>
</li>
<li>
<p><strong>Investigate the SuspendLockout wakelock</strong></p>
</li>
<li>This lock is usually set by the framework during operations such as OTA updates, battery‚Äësaving mode changes, or when a critical system service is initializing.</li>
<li>Check recent logs (<code>adb logcat -b events | grep -i suspendlockout</code>) for messages that set or clear this lock.</li>
<li>
<p>If the lock persists after the operation should be finished, a system bug may be present; a reboot often clears it.</p>
</li>
<li>
<p><strong>Address the active USB wakelock (<code>a600000.hsusb</code>)</strong></p>
</li>
<li>The USB controller may be held by a connected peripheral (e.g., OTG device, debugging session, or a stuck driver).</li>
<li>Run <code>adb shell dumpsys usb</code> to see the current USB state. Detach any USB accessories, disable USB debugging, or power‚Äëcycle the device.</li>
<li>
<p>If the wakelock remains, consider disabling the USB driver temporarily for testing:
     <code>echo disable &gt; /sys/bus/platform/drivers/usb/uevent</code>
     (use with caution; re‚Äëenable after testing).</p>
</li>
<li>
<p><strong>Force a suspend cycle after clearing wakelocks</strong></p>
</li>
<li>Once the above locks are cleared, you can manually trigger suspend to verify the path:
     <code>adb shell dumpsys power suspend now</code></li>
<li>
<p>Or use <code>adb shell echo mem &gt; /sys/power/state</code> (requires root).</p>
</li>
<li>
<p><strong>Long‚Äëterm mitigation</strong></p>
</li>
<li><strong>App hygiene:</strong> Encourage developers to release wake locks promptly (<code>PowerManager.WakeLock.release()</code>), especially display and partial wake locks.</li>
<li><strong>System updates:</strong> Ensure the device runs the latest security/patch level; many suspend‚Äërelated bugs are fixed in newer kernel/PMU releases.</li>
<li><strong>Monitoring:</strong> Set up a periodic script to log wake‚Äëlock status; if a lock remains active for &gt;‚ÄØ5‚ÄØminutes, automatically dump stack traces for investigation.</li>
</ol>
<p>By clearing the active <strong>Display</strong>, <strong>SuspendLockout</strong>, and <strong>USB</strong> wake locks, the device will be able to enter suspend normally, and subsequent suspend attempts will be recorded in <code>/d/suspend_stats</code>.</p>
<hr />
<h2>üìÅ Evidence Files</h2>
<ul>
<li><strong>dumpsys_suspend.txt</strong>: <code>C:\Users\xingya\OneDrive - Qualcomm\Desktop\AI_tools\suspend_mvp\cases\suspend\blocked_bywakelock\dumpsys_suspend.txt</code></li>
</ul>
<hr />
<h2>‚úÖ Verification Checklist</h2>
<p>After fixing the identified issue:</p>
<ol>
<li><strong>Re-run diagnosis</strong>: Collect new evidence and verify the issue is resolved</li>
<li><strong>Check suspend_stats</strong>: Verify success count increases and fail count remains 0</li>
<li><strong>Check wakelocks</strong>: Ensure no active wakelocks in dumpsys output</li>
<li><strong>Measure power</strong>: Compare power consumption before/after fix (expect ‚â•3% reduction)</li>
</ol>
    </div>
</body>
</html>